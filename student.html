<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Student – AIMatch Bharat</title>
  <style>
    :root {
      --primary: #1a237e;
      --accent: #ff9800;
      --bg: #f4f6fb;
      --text: #111;
      --fail: #f44336;
    }
    body {
      font-family: 'Inter', Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      margin: 0;
      padding: 0;
    }
    .navbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 20px;
      background: var(--primary);
      color: #fff;
    }
    .navbar a {
      color: #fff;
      text-decoration: none;
      font-weight: 500;
      cursor: pointer;
    }
    .container {
      max-width: 900px;
      margin: 20px auto;
      padding: 20px;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }
    h2 {
      color: var(--primary);
      text-align: center;
    }
    input, select, textarea {
      width: 100%;
      padding: 10px;
      margin: 8px 0;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    button {
      padding: 10px 14px;
      border-radius: 8px;
      border: none;
      background: var(--accent);
      color: #fff;
      font-weight: 700;
      cursor: pointer;
    }
    .progress {
      width: 100%;
      height: 16px;
      background: #eee;
      border-radius: 8px;
      overflow: hidden;
      margin: 12px 0;
    }
    .progress>div {
      height: 100%;
      background: var(--primary);
      width: 0%;
      transition: width .4s;
    }
    .feedback {
      color: var(--fail);
      font-weight: 700;
      text-align: center;
      margin-top: 12px;
    }
    .intern {
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #ddd;
      margin: 8px 0;
      background: #fafafa;
    }
    .top-actions {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    .small {
      font-size: 0.9rem;
      color: #555;
    }
    .back {
      background: #3949ab;
    }
    .logout {
      background: #f44336;
    }
    @media(max-width:720px) {
      .navbar {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
    }
  </style>
</head>

<body>

  <nav class="navbar">
    <div><img src="NE_Preview1.webp" width="28" alt=""> AIMatch Bharat – Student</div>
    <div><a onclick="goHome()" class="small">Home</a> | <a onclick="doLogout()" class="small">Logout</a></div>
  </nav>

  <div class="container" id="app">
    <h2>Student Profile & AI Matching</h2>

    <!-- Step 1: profile -->
    <div id="stepProfile">
      <p class="small">Complete your profile (required before analysis)</p>
      <input id="p_name" placeholder="Full name" />
      <input id="p_email" placeholder="Email" disabled />
      <select id="Gender">
        <option value="">Gender</option>
        <option value="Male">Male</option>
        <option value="Female">Female</option>
        <option value="Others">Others</option>
      </select>
      <input id="p_college" placeholder="College / University" />
      <input id="p_field" placeholder="Field of study" />
      <select id="p_grad">
        <option value="">Graduating Year</option>
        <option>2025</option>
        <option>2026</option>
        <option>2027</option>
        <option>2028</option>
      </select>
      <input id="p_district" placeholder="Rural District (if any)" />
      <select id="p_category">
        <option value="">Reserved Category</option>
        <option value="General">General</option>
        <option value="SC">SC</option>
        <option value="ST">ST</option>
        <option value="OBC">OBC</option>
        <option value="EWS">EWS</option>
        <option value="PwD">PwD</option>
      </select>
      <select id="sector" required>
        <option value="">Sector of Interest</option>
        <option value="Software Development">Software Development</option>
        <option value="AI/ML">AI/ML</option>
        <option value="Data Science">Data Science</option>
        <option value="Cloud Computing">Cloud Computing</option>
        <option value="Cybersecurity">Cybersecurity</option>
        <option value="Web Development">Web Development</option>
        <option value="Mobile App Development">Mobile App Development</option>
        <option value="UI/UX Design">UI/UX Design</option>
        <option value="Digital Marketing">Digital Marketing</option>
        <option value="Finance">Finance</option>
        <option value="Healthcare">Healthcare</option>
        <option value="Education">Education</option>
        <option value="Agriculture">Agriculture</option>
        <option value="E-commerce">E-commerce</option>
        <option value="IoT">Internet of Things (IoT)</option>
        <option value="Blockchain">Blockchain</option>
        <option value="Robotics">Robotics</option>
        <option value="Game Development">Game Development</option>
        <option value="AR/VR">Augmented/Virtual Reality</option>
        <option value="Other">Other</option>
      </select>
      <input id="p_location" placeholder="Preferred Location" />
      <input id="p_skills" placeholder="Skills (comma separated) e.g. python,ml,sql" />
      <div class="top-actions">
        <button onclick="saveProfile()">Save & Analyze</button>
        <button class="back" onclick="clearProfile()">Clear</button>
      </div>
    </div>

    <!-- Step 2: AI progress -->
    <div id="stepAI" style="display:none">
      <h3 style="text-align:center">AI/ML Engine analyzing your profile...</h3>
      <div class="progress">
        <div id="progressFill"></div>
      </div>
      <p id="aiMessage" class="small" style="text-align:center"></p>
    </div>

    <!-- Step 3: Test -->
    <div id="stepTest" style="display:none">
      <h3 style="text-align:center">Aptitude / Skill Test</h3>
      <div id="questions"></div>
      <div style="text-align:center;margin-top:10px"><button onclick="submitTest()">Submit Test</button></div>
    </div>

    <!-- Step 4: Results & Internships -->
    <div id="stepResult" style="display:none">
      <h3 style="text-align:center">Result</h3>
      <p id="resultText" style="text-align:center;font-weight:700"></p>
      <div id="feedbackArea"></div>
      <div id="matchedArea"></div>
    </div>
  </div>

  <script>
    // session check
    const current = JSON.parse(localStorage.getItem('currentUser') || 'null');
    if (!current || current.role !== 'student') { 
      alert('Please login as student first'); 
      location.href = 'index.html'; 
    }
    document.getElementById('p_email').value = current.email;

    // questions list
    const Q = [
      { q: "If 3x+5=20, x=?", options: ["3", "5", "7", "10"], correct: 1 },
      { q: "Next: 2,4,8,16,?", options: ["20", "32", "24", "30"], correct: 1 },
      { q: "Odd one out: Apple,Banana,Carrot,Mango", options: ["Apple", "Banana", "Carrot", "Mango"], correct: 2 },
      { q: "Train 60km/h. Distance in 3h?", options: ["120", "150", "180", "200"], correct: 2 },
      { q: "15% of 200?", options: ["25", "30", "35", "40"], correct: 1 }
    ];

    function saveProfile() {
      const profile = {
        name: document.getElementById('p_name').value.trim(),
        email: current.email,
        college: document.getElementById('p_college').value.trim(),
        field: document.getElementById('p_field').value.trim(),
        graduatingYear: document.getElementById('p_grad').value,
        district: document.getElementById('p_district').value.trim(),
        category: document.getElementById('p_category').value,
        sector: document.getElementById('sector').value,   // ✅ fixed this line
        location: document.getElementById('p_location').value.trim(),
        skills: document.getElementById('p_skills').value.split(',').map(s => s.trim().toLowerCase()).filter(Boolean)
      };
      // minimal validation
      if (!profile.name || !profile.email || profile.skills.length === 0) {
        alert('Please fill name, email and skills');
        return;
      }
      const profiles = JSON.parse(localStorage.getItem('profiles') || '{}');
      profiles[profile.email] = profile;
      localStorage.setItem('profiles', JSON.stringify(profiles));
      document.getElementById('stepProfile').style.display = 'none';
      document.getElementById('stepAI').style.display = 'block';
      simulateAI(profile);
    }

    function clearProfile() {
      document.getElementById('p_name').value = '';
      document.getElementById('p_skills').value = '';
    }

    function simulateAI(profile) {
      const msgs = ["Analyzing profile...", "Checking skills...", "Assessing reserved category...", "Matching internships...", "Finalizing..."];
      let i = 0, w = 0;
      const interval = setInterval(() => {
        w += 20;
        document.getElementById('progressFill').style.width = w + '%';
        document.getElementById('aiMessage').innerText = msgs[i] || '';
        i++;
        if (w >= 100) { clearInterval(interval); setTimeout(() => { startTest(); }, 500); }
      }, 700);
    }

    function startTest() {
      document.getElementById('stepAI').style.display = 'none';
      document.getElementById('stepTest').style.display = 'block';
      const qEl = document.getElementById('questions');
      qEl.innerHTML = '';
      Q.forEach((qq, idx) => {
        let block = document.createElement('div');
        block.innerHTML = `<p>${idx + 1}. ${qq.q}</p>`;
        qq.options.forEach((opt, j) => {
          block.innerHTML += `<label style="display:block"><input type="radio" name="q${idx}" value="${j}"> ${opt}</label>`;
        });
        qEl.appendChild(block);
      });
    }

    function submitTest() {
      let score = 0;
      Q.forEach((qq, i) => {
        const sel = document.querySelector(`input[name="q${i}"]:checked`);
        if (sel && parseInt(sel.value) === qq.correct) score++;
      });
      document.getElementById('stepTest').style.display = 'none';
      document.getElementById('stepResult').style.display = 'block';
      showResult(score);
    }

    function showResult(score) {
      const resultText = document.getElementById('resultText');
      const feedbackArea = document.getElementById('feedbackArea');
      const matchedArea = document.getElementById('matchedArea');
      feedbackArea.innerHTML = '';
      matchedArea.innerHTML = '';
      if (score >= 3) {
        resultText.innerText = `Congratulations — you passed (${score}/${Q.length})`;
        const profiles = JSON.parse(localStorage.getItem('profiles') || '{}');
        const student = profiles[current.email] || { skills: [] };
        const approved = JSON.parse(localStorage.getItem('approvedInternships') || '[]');
        if (approved.length === 0) {
          matchedArea.innerHTML = '<p class="small">No approved internships yet. Check back later.</p>';
          return;
        }
        matchedArea.innerHTML = '<h4>Matched internships</h4>';
        approved.forEach(intn => {
          let match = 0;
          const roleTokens = (intn.role || '').toLowerCase().split(/\W+/).filter(Boolean);
          student.skills.forEach(s => {
            if (roleTokens.includes(s)) match++;
          });
          const pct = Math.min(100, 50 + match * 25);
          const div = document.createElement('div');
          div.className = 'intern';
          div.innerHTML = `<h4>${intn.companyName || intn.companyEmail} — ${intn.role}</h4>
                       <p>Location: ${intn.location} | Stipend: ${intn.stipend} | Match: ${pct}%</p>
                       <button onclick='applyTo("${intn.id}")'>Apply</button>`;
          matchedArea.appendChild(div);
        });
      } else {
        resultText.innerText = `You did not pass (${score}/${Q.length})`;
        feedbackArea.innerHTML = '<p class="feedback">AI Feedback: Practice basic math, logic and problem solving. Try again after practicing.</p>';
      }
    }

    function applyTo(internshipId) {
      const apps = JSON.parse(localStorage.getItem('studentApplications') || '[]');
      const exists = apps.some(a => a.internshipId === internshipId && a.studentEmail === current.email);
      if (exists) {
        alert('You already applied for this internship');
        return;
      }
      const allApproved = JSON.parse(localStorage.getItem('approvedInternships') || '[]');
      const intern = allApproved.find(i => i.id === internshipId);
      if (!intern) {
        alert('Internship not found');
        return;
      }
      const app = {
        id: 'app_' + Date.now(),
        studentEmail: current.email,
        internshipId,
        companyEmail: intern.companyEmail,
        role: intern.role,
        status: 'Pending',
        appliedAt: new Date().toISOString()
      };
      apps.push(app);
      localStorage.setItem('studentApplications', JSON.stringify(apps));
      const notes = JSON.parse(localStorage.getItem('notifications') || '[]');
      notes.push({
        id: 'n_' + Date.now(),
        email: 'admin',
        text: `New application from ${current.email} for ${intern.role}`,
        createdAt: new Date().toISOString(),
        read: false
      });
      localStorage.setItem('notifications', JSON.stringify(notes));
      alert('Applied — pending admin approval.');
    }

    function goHome() { location.href = 'index.html'; }
    function doLogout() { localStorage.removeItem('currentUser'); alert('Logged out'); goHome(); }
  </script>
</body>

</html>
